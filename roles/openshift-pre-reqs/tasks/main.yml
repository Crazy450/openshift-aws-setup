---

- name: register VMs facts
  set_fact:
   master_public_ip: "35.158.180.215"
   node1_public_ip: "35.158.186.188"
   node2_public_ip: "35.157.181.156"
   bastion_public_ip: "35.158.238.200"

- name: install packages on bastion
  yum:
    name: "{{item}}"
    state: "present"
  delegate_to: "{{bastion_public_ip}}"
  remote_user: "ec2-user"
  with_items:
    - "git"
    - "@Development Tools"
    - "python2-pip"
    - "openssl-devel"
    - "python-devel"
    - "gcc"
    - "libffi-devel"

- name: install ansible on bastion
  pip:
    name: ansible
    version: 2.2.0.0

- name: install docker on master and nodes
  yum:
    name: "docker"
    state: "present"
  delegate_to: "{{item}}"
  remote_user: "ec2-user"
  with_items: "[{{master_public_ip}},{{node1_public_ip}},{{node2_public_ip}}]"

