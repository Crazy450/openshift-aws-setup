---
- name: Gather EC2 facts
  ec2_remote_facts:
    region: "{{ region }}"
    filters:
      "tag:namespace": "{{namespace}}"
  register: ec2_facts

- name: Debug
  debug:
    msg: "{{ item.id }}"
  with_items: "{{ ec2_facts.instances }}"

- name: Terminate EC2 VMs
  ec2:
    state: absent
    region: "{{ region }}"
    instance_ids: "{{ item.id }}"
    wait: yes
  with_items: "{{ ec2_facts.instances }}"

#- name: gather instance from inventory
#  set_fact:
#    host: "{{ groups['tag_namespace_openshift'][0] }}"
#
#- pause:
#    prompt: 'I will terminate {{ name }} ({{host}}), ctrl-c to abort'
#  register: pause_result

#- name: terminate any matching ec2 instance
#  ec2:
#    state: absent
#    instance_ids: "{{ hostvars[host]['ec2_id'] }}"
#    region: "{{ region }}"
#    wait: yes
#  register: ec2_out
#  tags: ['ec2']
